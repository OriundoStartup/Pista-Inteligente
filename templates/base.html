<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="language" content="es">
    <meta name="robots" content="index, follow">

    <!-- Dynamic Title -->
    <title>{% block title %}Pista Inteligente - Predicciones HÃ­picas con IA{% endblock %}</title>

    <!-- Canonical URL -->
    <link rel="canonical" href="{% block canonical_url %}{{ request.url }}{% endblock %}">

    <!-- Meta Description (Dynamic) -->
    {% block meta_description %}
    <meta name="description"
        content="Predicciones hÃ­picas con Inteligencia Artificial para HipÃ³dromo Chile y Club HÃ­pico de Chile. AnÃ¡lisis profesional de carreras, pronÃ³sticos y estadÃ­sticas en tiempo real.">
    {% endblock %}

    <!-- Meta Keywords (Dynamic) -->
    {% block meta_keywords %}
    <meta name="keywords"
        content="programa hipÃ³dromo chile, club hÃ­pico de chile, predicciones hÃ­picas, carreras de caballos chile, pronÃ³sticos hipÃ³dromo, anÃ¡lisis hÃ­pico, inteligencia artificial carreras">
    {% endblock %}

    <!-- Open Graph / Facebook -->
    {% block og_tags %}
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:title"
        content="{% block og_title %}Pista Inteligente - Predicciones HÃ­picas con IA{% endblock %}">
    <meta property="og:description"
        content="{% block og_description %}Predicciones con IA para HipÃ³dromo Chile y Club HÃ­pico de Chile{% endblock %}">
    <meta property="og:image" content="{{ url_for('static', filename='img/header_brand.png', _external=True) }}">
    <meta property="og:locale" content="es_CL">
    <meta property="og:site_name" content="Pista Inteligente">
    {% endblock %}

    <!-- Twitter Card -->
    {% block twitter_tags %}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ request.url }}">
    <meta name="twitter:title"
        content="{% block twitter_title %}Pista Inteligente - Predicciones HÃ­picas{% endblock %}">
    <meta name="twitter:description"
        content="{% block twitter_description %}Predicciones con IA para carreras de caballos en Chile{% endblock %}">
    <meta name="twitter:image" content="{{ url_for('static', filename='img/header_brand.png', _external=True) }}">
    {% endblock %}

    <!-- Schema.org Structured Data (Dynamic) -->
    {% block schema_data %}{% endblock %}

    <!-- Google Fonts: Outfit (Modern Sans) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">

    <!-- Main CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5579178295407019"
        crossorigin="anonymous"></script>

    <!-- Firebase SDK (Analytics + Performance) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { getPerformance } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-performance.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCEKzonZpbAMEDML3noTJbxg3Zr89Ojp7k",
            authDomain: "pista-inteligente.firebaseapp.com",
            projectId: "pista-inteligente",
            storageBucket: "pista-inteligente.firebasestorage.app",
            messagingSenderId: "286245664040",
            appId: "1:286245664040:web:d4b9f31c39e7de909c0c1d",
            measurementId: "G-ZPL096F6VZ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        // Analytics - rastrea usuarios y eventos
        const analytics = getAnalytics(app);

        // Performance Monitoring - mide tiempos de carga
        const perf = getPerformance(app);

        // Log page view event
        logEvent(analytics, 'page_view', {
            page_title: document.title,
            page_location: window.location.href,
            page_path: window.location.pathname
        });

        // Make analytics available globally for custom events
        window.firebaseAnalytics = analytics;
        window.logFirebaseEvent = (eventName, params) => logEvent(analytics, eventName, params);
    </script>
</head>

<body>

    <!-- Header Glassmorphism -->
    <header class="glass-header">
        <a href="/" class="brand">
            <img src="{{ url_for('static', filename='img/logo.jpg') }}" alt="Logo"
                style="height: 40px; border-radius: 50%;">
            <span>Pista Inteligente</span>
        </a>
        <nav class="nav-links">
            <a href="/" class="nav-link {% if request.path == '/' %}active{% endif %}">Inicio</a>
            <a href="/programa" class="nav-link {% if request.path == '/programa' %}active{% endif %}">Predicciones</a>
            <a href="/precision" class="nav-link {% if request.path == '/precision' %}active{% endif %}">PrecisiÃ³n</a>
            <a href="/analisis" class="nav-link {% if request.path == '/analisis' %}active{% endif %}">Patrones</a>
            <a href="/estadisticas"
                class="nav-link {% if request.path == '/estadisticas' %}active{% endif %}">EstadÃ­sticas</a>
        </nav>
    </header>

    <!-- Brand Header Image (Cabecera) -->
    <div class="hero-banner">
        <img src="{{ url_for('static', filename='img/header_brand.png') }}"
            alt="Pista Inteligente - Programa HipÃ³dromo Chile y Club HÃ­pico de Chile con Predicciones IA"
            class="hero-banner-img">
    </div>

    <!-- Top Banner: Google AdSense -->
    <div class="container" style="text-align: center; margin: 0; padding: 0.5rem 0;">
        <!-- AdSense Display Unit -->
        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5579178295407019"
            data-ad-slot="1234567890" data-ad-format="auto" data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <!-- Main Content -->
    <main class="container">
        {% block content %}{% endblock %}

        <!-- Bottom Banner: Google AdSense -->
        <div class="container" style="text-align: center; margin-top: 3rem;">
            <!-- AdSense Display Unit -->
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5579178295407019"
                data-ad-slot="1234567890" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <!-- Sidebar/Extra: Google AdSense -->
        <div style="text-align:center; margin-top:1rem;">
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5579178295407019"
                data-ad-slot="1234567890" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </main>

    <!-- Chatbot Widget -->
    <div class="chatbot-fab" id="chatbotBtn">
        <img src="{{ url_for('static', filename='img/bot_avatar.png') }}" alt="Chat"
            style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
    </div>

    <div class="chatbot-window" id="chatbotWindow">
        <div class="chat-header">
            <div style="display:flex; align-items:center; gap:0.5rem;">
                <img src="{{ url_for('static', filename='img/bot_avatar.png') }}"
                    style="height:30px; width:30px; border-radius:50%; border:1px solid white;">
                <span>ðŸ¤– Asistente HÃ­pico</span>
            </div>
            <span style="cursor:pointer" id="closeChat">âœ–</span>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="msg bot">Hola, soy tu asistente de IA. Â¿En quÃ© te puedo ayudar hoy?</div>
        </div>
        <div class="chat-footer">
            <input type="text" id="chatInput" class="chat-input" placeholder="Pregunta sobre una carrera...">
            <button id="sendBtn"
                style="padding:0.5rem; background:var(--secondary); border:none; border-radius:4px; cursor:pointer">âž¤</button>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Chatbot Logic
        const chatBtn = document.getElementById('chatbotBtn');
        const chatWindow = document.getElementById('chatbotWindow');
        const closeChat = document.getElementById('closeChat');
        const sendBtn = document.getElementById('sendBtn');
        const chatInput = document.getElementById('chatInput');
        const chatBody = document.getElementById('chatBody');

        chatBtn.addEventListener('click', () => {
            chatWindow.style.display = chatWindow.style.display === 'flex' ? 'none' : 'flex';
        });

        closeChat.addEventListener('click', () => {
            chatWindow.style.display = 'none';
        });

        async function sendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            // User Message
            addMessage(text, 'user');
            chatInput.value = '';

            // AI Response
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text })
                });
                const data = await response.json();
                addMessage(data.response, 'bot');
            } catch (error) {
                addMessage('Lo siento, hubo un error al conectar con la IA.', 'bot');
            }
        }

        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `msg ${sender}`;
            div.innerText = text;
            chatBody.appendChild(div);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <p class="copyright">Â© 2025 Pista Inteligente. Todos los derechos reservados.</p>
            <p class="credits">
                Sitio creado por
                <a href="https://oriundostartupchile.com" target="_blank" rel="noopener noreferrer">
                    oriundostartupchile.com
                </a>
            </p>
        </div>
    </footer>
</body>

</html>